<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Max Czapanskiy">
<meta name="dcterms.date" content="2024-09-01">

<title>Detection range inference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="detect_range_files/libs/clipboard/clipboard.min.js"></script>
<script src="detect_range_files/libs/quarto-html/quarto.js"></script>
<script src="detect_range_files/libs/quarto-html/popper.min.js"></script>
<script src="detect_range_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="detect_range_files/libs/quarto-html/anchor.min.js"></script>
<link href="detect_range_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="detect_range_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="detect_range_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="detect_range_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="detect_range_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#simulated-whale-track" id="toc-simulated-whale-track" class="nav-link active" data-scroll-target="#simulated-whale-track">Simulated whale track</a></li>
  <li><a href="#correlated-and-biased-random-walks" id="toc-correlated-and-biased-random-walks" class="nav-link" data-scroll-target="#correlated-and-biased-random-walks">Correlated and biased random walks</a></li>
  <li><a href="#inferring-navigation" id="toc-inferring-navigation" class="nav-link" data-scroll-target="#inferring-navigation">Inferring navigation</a>
  <ul class="collapse">
  <li><a href="#track-generating-processes" id="toc-track-generating-processes" class="nav-link" data-scroll-target="#track-generating-processes">Track generating processes</a></li>
  <li><a href="#model-fitting-and-comparison" id="toc-model-fitting-and-comparison" class="nav-link" data-scroll-target="#model-fitting-and-comparison">Model fitting and comparison</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Detection range inference</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Max Czapanskiy </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 1, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_classic</span>())</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How do we tell if an animal was navigating towards a target? The third chapter of James Fahlbusch’s dissertation asks this question about whales and krill. He identified krill swarms from the whales’ feeding behavior, then looked at a window preceding the onset of feeding to ask how far away whales start navigating towards their target. It’s a very cool question with a perfect dataset to investigate it!</p>
<section id="simulated-whale-track" class="level2">
<h2 class="anchored" data-anchor-id="simulated-whale-track">Simulated whale track</h2>
<p>Designing an appropriate statistical model is going to be tricky. Let’s simulate a whale approaching a krill patch to explain why.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate 15 time steps</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial conditions: start at 0,0 heading NE</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> y <span class="ot">&lt;-</span> theta <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(t))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span>] <span class="ot">&lt;-</span> y[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>theta[<span class="dv">1</span>] <span class="ot">&lt;-</span> pi <span class="sc">/</span> <span class="dv">4</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># At each time step, turn a little bit</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># New random direction is drawn from a von Mises distribution</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># centered on the previous time step's direction</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># kappa defines the concentration of the turning angle distribution</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>kappa <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Start swimming!</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (.t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">max</span>(t)) {</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  x[.t] <span class="ot">&lt;-</span> x[.t <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">cos</span>(theta[.t <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  y[.t] <span class="ot">&lt;-</span> y[.t <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">sin</span>(theta[.t <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  theta[.t] <span class="ot">&lt;-</span> CircStats<span class="sc">::</span><span class="fu">rvm</span>(<span class="dv">1</span>, theta[.t <span class="sc">-</span> <span class="dv">1</span>], kappa)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Put the track together</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># target is the last point of the track</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">x =</span> x[<span class="fu">length</span>(x)], <span class="at">y =</span> y[<span class="fu">length</span>(y)])</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>track <span class="ot">&lt;-</span> <span class="fu">tibble</span>(t, x, y, theta)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's see it</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(track, <span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>() <span class="sc">+</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>           target[<span class="st">"x"</span>], target[<span class="st">"y"</span>], </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"firebrick"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="detect_range_files/figure-html/whale-krill-track-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Look at the whale’s path from approximately (4, 6) to the krill swarm, in red. Sort of looks like the whale started navigating towards the target at that point, doesn’t it? Let’s look at the relative angle between each turning angle and the actual bearing to the krill. I’ve shaded in the region where the difference between the step direction and the bearing to the target is within 15°. If we define navigating towards a target as “all steps are within 15° of the target’s bearing”, we can see that the last third of the track appears to be “navigating to the target”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Utility function for normalizing an angle to [-pi, pi)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>normalize_angle <span class="ot">&lt;-</span> \(x) (x <span class="sc">+</span> pi) <span class="sc">%%</span> (<span class="dv">2</span> <span class="sc">*</span> pi) <span class="sc">-</span> pi</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># gamma = bearing to krill</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># epsilon = difference between step angle (theta) and gamma</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>track <span class="ot">&lt;-</span> <span class="fu">mutate</span>(track, </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">gamma =</span> <span class="fu">atan2</span>(target[<span class="st">"y"</span>] <span class="sc">-</span> y, target[<span class="st">"x"</span>] <span class="sc">-</span> x),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">epsilon =</span> <span class="fu">normalize_angle</span>(gamma <span class="sc">-</span> theta))</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(track, <span class="fu">aes</span>(t, epsilon)) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"gray"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"ribbon"</span>, </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="dv">15</span> <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>, </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="dv">15</span> <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>, </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Bearing error"</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>pi <span class="sc">/</span> <span class="dv">4</span>, pi <span class="sc">/</span> <span class="dv">12</span>, <span class="at">by =</span> pi <span class="sc">/</span> <span class="dv">12</span>),</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">45</span>, <span class="dv">15</span>, <span class="at">by =</span> <span class="dv">15</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-whale-krill-epsilon" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-whale-krill-epsilon-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="detect_range_files/figure-html/fig-whale-krill-epsilon-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-whale-krill-epsilon-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: The last third of a correlated random walk has the apparent appearance of navigating to a target.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Here’s the problem: this whale doesn’t know where the krill are. We didn’t tell the whale where to go, we only said to turn slightly at each time step. This track is therefore a <em>correlated random walk</em> (CRW), with no knowledge of the krill swarm’s location. By picking the target as the end of the track, we guarantee some part of a non-navigating track will look like navigation just by chance. The stronger the correlation (our turning angle concentration, <span class="math inline">\(\kappa\)</span>), the farther back in time this false positive result will extend.</p>
</section>
<section id="correlated-and-biased-random-walks" class="level2">
<h2 class="anchored" data-anchor-id="correlated-and-biased-random-walks">Correlated and biased random walks</h2>
<p>If the whale is really navigating towards something, we should see a <em>biased random walk</em> (BRW) instead. We can use a single model to describe both CRWs and BRWs. The parameter <span class="math inline">\(\beta\)</span> tilts the model one way or the other: <span class="math inline">\(\beta=0\)</span> is a CRW and <span class="math inline">\(\beta=1\)</span> is a BRW. We specify the model as:</p>
<p><span id="eq-bcrw"><span class="math display">\[
\begin{align}
\theta_t &amp;= von~Mises(\mu_t, \kappa) \\
x_1 &amp;= y_1 = \theta_1 = \gamma_1 = 0 \\
\gamma_t &amp;= tan^{-1}\frac{y_n - y_{t-1}}{x_n - x_{t-1}} \\
\mu_t &amp;= \theta_{t-1}(1 - \beta) + \gamma_t \beta \\
x_t &amp;= x_{t - 1} + cos~\theta_t \\
y_t &amp;= y_{t - 1} + sin~\theta_t \\
\end{align}
\tag{1}\]</span></span></p>
<p>Two notes about <a href="#eq-bcrw" class="quarto-xref">Equation&nbsp;1</a>. First, our calculation for <span class="math inline">\(\mu_t\)</span> is a bit misleading. That’s an arithemtic weighted average, where the average of <span class="math inline">\(\theta_{t-1}\)</span> and <span class="math inline">\(\gamma_t\)</span> are weighted by <span class="math inline">\(\beta\)</span>. But <span class="math inline">\(\theta\)</span> and <span class="math inline">\(\gamma\)</span> are angles, so we actually want a circular weighted average. Let’s define the circular weighted average using vectors. Start with the unit vectors for the two angles we want to average. Multiply them by the weights. Then get the bearing of their sum. Graphically the weighted average (bearing of purple) looks like this, for <span class="math inline">\(\theta = 30 ^{\circ}\)</span> (red), <span class="math inline">\(\gamma = 135 ^{\circ}\)</span> (blue), and <span class="math inline">\(\beta = 0.8\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> pi <span class="sc">/</span> <span class="dv">6</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">*</span> pi</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>theta_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">cos</span>(theta), <span class="fu">sin</span>(theta)) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> beta)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>gamma_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">cos</span>(gamma), <span class="fu">sin</span>(gamma)) <span class="sc">*</span> beta</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>mu_vec <span class="ot">=</span> theta_vec <span class="sc">+</span> gamma_vec</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">=</span> <span class="fu">atan2</span>(mu_vec[<span class="dv">2</span>], mu_vec[<span class="dv">1</span>])</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">pty =</span> <span class="st">"s"</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">xlab =</span> <span class="st">"x"</span>, <span class="at">ylab =</span> <span class="st">"y"</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="dv">0</span>, <span class="dv">0</span>, theta_vec[<span class="dv">1</span>], theta_vec[<span class="dv">2</span>], <span class="at">col =</span> <span class="st">"firebrick"</span>, <span class="at">angle =</span> <span class="dv">10</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(theta_vec[<span class="dv">1</span>], theta_vec[<span class="dv">2</span>], </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>       theta_vec[<span class="dv">1</span>] <span class="sc">+</span> gamma_vec[<span class="dv">1</span>], theta_vec[<span class="dv">2</span>] <span class="sc">+</span> gamma_vec[<span class="dv">2</span>],</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"cornflowerblue"</span>, <span class="at">angle =</span> <span class="dv">10</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="dv">0</span>, <span class="dv">0</span>, </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>       mu_vec[<span class="dv">1</span>], mu_vec[<span class="dv">2</span>],</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"darkorchid"</span>, <span class="at">angle =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="detect_range_files/figure-html/circ-wgt-avg-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>circ_wgt_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(a, w) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Using vector sums</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  ax <span class="ot">&lt;-</span> <span class="fu">cos</span>(a) <span class="sc">*</span> w</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  ay <span class="ot">&lt;-</span> <span class="fu">sin</span>(a) <span class="sc">*</span> w</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">sum</span>(ax)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">sum</span>(ay)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">atan2</span>(y, x)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Second note about <a href="#eq-bcrw" class="quarto-xref">Equation&nbsp;1</a>. We define <span class="math inline">\(\gamma\)</span> at the bearing to the target, which is the last point of the track <span class="math inline">\((x_n, y_n)\)</span>. That’s circular logic! There’s a workaround, though. We can simulate the walk in reverse, starting at the end and repelling from the end instead of being attracted to it.</p>
<p>Therefore, our actual model, which uses a circular weighted mean for <span class="math inline">\(\mu\)</span> and walks backwards in time is:</p>
<p><span id="eq-bcrw2"><span class="math display">\[
\begin{align}
\theta_t &amp;= von~Mises(\mu_t, \kappa) \\
x_n &amp;= y_n = \theta_n = \gamma_n = 0 \\
\gamma_t &amp;= tan^{-1}\frac{y_n - y_{t+1}}{x_n - x_{t+1}} \\
\vec{\mu_t} &amp;= \hat{\theta}_{t+1}(1 - \beta) + \hat{\gamma}_t \beta \\
\mu_t &amp;= tan^{-1}\frac{\mu_{ty}}{\mu_{tx}} \\
x_t &amp;= x_{t + 1} - cos~\theta_t \\
y_t &amp;= y_{t + 1} - sin~\theta_t \\
\end{align}
\tag{2}\]</span></span></p>
<p>Let’s use this model to demonstrate the ambiguity between CRWs and BRWs for the navigation problem. We define a function <code>sim_tail()</code>, which simulates the tail end of random walk. Basically, it finds the shaded part of <a href="#fig-whale-krill-epsilon" class="quarto-xref">Figure&nbsp;1</a>. Starting at the end of a track, it walks backwards until the absolute difference between the step direction and the bearing to the target (<span class="math inline">\(\epsilon\)</span>) exceeds our critical threshold (<span class="math inline">\(\bar \epsilon\)</span>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate a tail</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>sim_tail <span class="ot">&lt;-</span> <span class="cf">function</span>(epsilon_thr, kappa, beta, <span class="at">max_t =</span> <span class="fl">1e3</span>) {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initial settings</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x,y     = position</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># theta   = step direction</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># gamma   = bearing to target</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># epsilon = error (difference of theta, gamma)</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y <span class="ot">&lt;-</span> theta <span class="ot">&lt;-</span> gamma <span class="ot">&lt;-</span> epsilon <span class="ot">&lt;-</span> <span class="fu">numeric</span>(max_t)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  x[<span class="dv">1</span>] <span class="ot">&lt;-</span> y[<span class="dv">1</span>] <span class="ot">&lt;-</span> epsilon[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  theta[<span class="dv">1</span>] <span class="ot">&lt;-</span> gamma[<span class="dv">1</span>] <span class="ot">&lt;-</span> pi <span class="sc">/</span> <span class="dv">4</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="fu">abs</span>(epsilon[t <span class="sc">-</span> <span class="dv">1</span>]) <span class="sc">&lt;=</span> epsilon_thr <span class="sc">&amp;&amp;</span> t <span class="sc">&lt;</span> max_t) {</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update location from previous step direction</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    x[t] <span class="ot">&lt;-</span> x[t <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">-</span> <span class="fu">cos</span>(theta[t <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    y[t] <span class="ot">&lt;-</span> y[t <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">-</span> <span class="fu">sin</span>(theta[t <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Draw next step</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    gamma[t] <span class="ot">&lt;-</span> <span class="fu">atan2</span>(<span class="sc">-</span>y[t], <span class="sc">-</span>x[t])</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> <span class="fu">circ_wgt_mean</span>(<span class="fu">c</span>(theta[t <span class="sc">-</span> <span class="dv">1</span>], gamma[t]), <span class="fu">c</span>(<span class="dv">1</span> <span class="sc">-</span> beta, beta))</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    theta[t] <span class="ot">&lt;-</span> <span class="fu">normalize_angle</span>(CircStats<span class="sc">::</span><span class="fu">rvm</span>(<span class="dv">1</span>, mu, kappa))</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    epsilon[t] <span class="ot">&lt;-</span> <span class="fu">normalize_angle</span>(gamma[t] <span class="sc">-</span> theta[t])</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    t <span class="ot">&lt;-</span> t <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="fu">tibble</span>(<span class="at">t =</span> <span class="fu">seq</span>(max_t), x, y, theta, gamma, epsilon), t <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">sqrt</span>(x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> y<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the tail</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>plot_tail <span class="ot">&lt;-</span> <span class="cf">function</span>(t) {</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  angles <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(t, <span class="fu">c</span>(theta, gamma),</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>                         <span class="at">names_to =</span> <span class="st">"angle"</span>, <span class="at">values_to =</span> <span class="st">"radians"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">xend =</span> x <span class="sc">+</span> <span class="fl">0.75</span> <span class="sc">*</span> <span class="fu">cos</span>(radians),</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">yend =</span> y <span class="sc">+</span> <span class="fl">0.75</span> <span class="sc">*</span> <span class="fu">sin</span>(radians))</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  epsilon_labels <span class="ot">&lt;-</span> <span class="fu">pretty</span>(<span class="fu">seq</span>(<span class="fu">min</span>(t<span class="sc">$</span>epsilon) <span class="sc">*</span> <span class="dv">180</span><span class="sc">/</span>pi,</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">max</span>(t<span class="sc">$</span>epsilon) <span class="sc">*</span> <span class="dv">180</span><span class="sc">/</span>pi,</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>                               <span class="at">length.out =</span> <span class="dv">5</span>))</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  epsilon_breaks <span class="ot">&lt;-</span> epsilon_labels <span class="sc">*</span> pi<span class="sc">/</span><span class="dv">180</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(t, <span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_path</span>() <span class="sc">+</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> xend, <span class="at">yend =</span> yend, <span class="at">color =</span> angle), angles) <span class="sc">+</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"firebrick"</span>) <span class="sc">+</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="st">"top"</span>),</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(t, <span class="fu">aes</span>(t,  epsilon)) <span class="sc">+</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"gray"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="st">"epsilon (deg)"</span>,</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>                         <span class="at">breaks =</span> epsilon_breaks,</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> epsilon_labels),</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see a random tail for <span class="math inline">\(\bar \epsilon\)</span> = 30°, <span class="math inline">\(\kappa\)</span> = 20, and <span class="math inline">\(\beta\)</span> = 0 (i.e., a CRW).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>crw <span class="ot">&lt;-</span> <span class="fu">sim_tail</span>(<span class="dv">30</span> <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>, <span class="at">kappa =</span> <span class="dv">20</span>, <span class="at">beta =</span> <span class="dv">0</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_tail</span>(crw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-crw-tail" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-crw-tail-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="detect_range_files/figure-html/fig-crw-tail-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crw-tail-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Tail of a correlated random walk with <span class="math inline">\(\bar \epsilon\)</span> = 30° and <span class="math inline">\(\kappa\)</span> = 20.
</figcaption>
</figure>
</div>
</div>
</div>
<p>This tail shows <span class="math inline">\(\epsilon\)</span> can remain in the range <span class="math inline">\([-\hat{\epsilon}, \hat{\epsilon}]\)</span> for a pretty long time (~20 steps), even when there’s no bias towards the target.</p>
<p>Let’s simulate a bunch of tails for <span class="math inline">\(\beta\)</span> = 0, 0.5, and 1 (i.e., CRW, mixed BCRW, and BRW) at different values of <span class="math inline">\(\hat{\epsilon}\)</span>. If the length of the tails overlap, our metric is a poor fit for differentiating the null (CRW) and alternative (BRW) models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>n_epsilon <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>n_iter <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>kappa <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>tails <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">i =</span> <span class="fu">seq</span>(n_iter),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">epsilon =</span> <span class="fu">seq</span>(<span class="dv">0</span>, pi<span class="sc">/</span><span class="dv">4</span>, <span class="at">length.out =</span> n_epsilon),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> betas</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tail_length =</span> <span class="fu">mapply</span>(</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    \(e, b) <span class="fu">nrow</span>(<span class="fu">sim_tail</span>(<span class="at">epsilon_thr =</span> e, kappa, <span class="at">beta =</span> b)),</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    epsilon, beta</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>epsilon_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  epsilon_labels <span class="ot">&lt;-</span> <span class="fu">pretty</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(x<span class="sc">$</span>epsilon) <span class="sc">*</span> <span class="dv">180</span> <span class="sc">/</span> pi, <span class="at">length.out =</span> <span class="dv">5</span>))</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  epsilon_breaks <span class="ot">&lt;-</span> epsilon_labels <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">%&gt;%</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(beta, epsilon) <span class="sc">%&gt;%</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">tail_mean =</span> <span class="fu">mean</span>(tail_length),</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">tail_lwr =</span> <span class="fu">quantile</span>(tail_length, <span class="fl">0.1</span>),</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">tail_upr =</span> <span class="fu">quantile</span>(tail_length, <span class="fl">0.9</span>),</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">beta =</span> <span class="fu">factor</span>(beta)) <span class="sc">%&gt;%</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(epsilon)) <span class="sc">+</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> tail_lwr, <span class="at">ymax =</span> tail_upr, <span class="at">fill =</span> beta),</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> tail_mean, <span class="at">color =</span> beta), <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(epsilon),</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> epsilon_breaks,</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> epsilon_labels) <span class="sc">+</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Tail length (steps)"</span>)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">ggdraw</span>(<span class="fu">epsilon_plot</span>(tails) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)) <span class="sc">+</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  cowplot<span class="sc">::</span><span class="fu">draw_plot</span>(<span class="fu">epsilon_plot</span>(<span class="fu">filter</span>(tails, epsilon <span class="sc">&lt;</span> pi <span class="sc">/</span> <span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"inside"</span>,</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>                             <span class="at">legend.position.inside =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.99</span>),</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>                             <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)),</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>                     <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-crw-brw" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-crw-brw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="detect_range_files/figure-html/fig-crw-brw-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crw-brw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: The length of a tail, defined as the number of steps at the end of a random walk within <span class="math inline">\(\epsilon\)</span> of the final location, is not substantially different between the null model (<span class="math inline">\(\beta = 0\)</span>; CRW) and the alternative model (<span class="math inline">\(\beta = 1\)</span>; BRW). Lines and shaded areas represent the mean and 80% CI of the simulated tail lengths across <span class="math inline">\(\epsilon\)</span> thresholds. The inset figure shows the same data, limited to <span class="math inline">\(\epsilon\)</span> &lt; 30°.
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-crw-brw" class="quarto-xref">Figure&nbsp;3</a> shows that a CRW with even moderate concentration (<span class="math inline">\(\kappa\)</span> = 10) will produce similar tails as a BRW for <span class="math inline">\(\hat{\epsilon}\)</span> &lt; 30°.</p>
</section>
<section id="inferring-navigation" class="level2">
<h2 class="anchored" data-anchor-id="inferring-navigation">Inferring navigation</h2>
<p>If the tail length metric fails to differentiate CRW and BRW motion, we must turn to other options to infer navigation. Here I describe four different track generating processes that could represent navigation.</p>
<section id="track-generating-processes" class="level3">
<h3 class="anchored" data-anchor-id="track-generating-processes">Track generating processes</h3>
<section id="turning-angle-concentration-increases" class="level4">
<h4 class="anchored" data-anchor-id="turning-angle-concentration-increases"><strong>Turning angle concentration increases</strong></h4>
<p>We assume the track is a CRW both before and after the prey detection event (i.e., <span class="math inline">\(\beta\)</span>=0), but <span class="math inline">\(\kappa\)</span> increases post-detection. For this option, we would try to infer 3 parameters:</p>
<ol type="1">
<li>The time of prey detection <span class="math inline">\(\hat{t}\)</span></li>
<li>The concentration of turning angles prior to prey detection <span class="math inline">\(\kappa_{t \lt \hat{t}}\)</span></li>
<li>The concentration of turning angles prior to prey detection <span class="math inline">\(\kappa_{t \geq \hat{t}}\)</span></li>
</ol>
</section>
<section id="turning-angles-bias-towards-target" class="level4">
<h4 class="anchored" data-anchor-id="turning-angles-bias-towards-target"><strong>Turning angles bias towards target</strong></h4>
<p>We assume the track switches from a CRW to a BRW after the prey detection event. For this option, we would try to infer 3 parameters:</p>
<ol type="1">
<li>The time of prey detection <span class="math inline">\(\hat{t}\)</span></li>
<li>The concentration of turning angles <span class="math inline">\(\kappa\)</span></li>
<li>The amount of bias towards the target <span class="math inline">\(\beta\)</span></li>
</ol>
</section>
<section id="turning-angles-bias-and-concentration-increases" class="level4">
<h4 class="anchored" data-anchor-id="turning-angles-bias-and-concentration-increases">Turning angles bias and concentration increases</h4>
<p>This is a combination of the previous two processes: a switch from CRW to BRW <em>and</em> concentration increases. We would try to infer 4 parameters:</p>
<ol type="1">
<li>The time of prey detection <span class="math inline">\(\hat{t}\)</span></li>
<li>The concentration of turning angles prior to prey detection <span class="math inline">\(\kappa_{t \lt \hat{t}}\)</span></li>
<li>The concentration of turning angles prior to prey detection <span class="math inline">\(\kappa_{t \geq \hat{t}}\)</span></li>
<li>The amount of bias towards the target <span class="math inline">\(\beta\)</span></li>
</ol>
</section>
<section id="bias-increases-as-predator-nears-target" class="level4">
<h4 class="anchored" data-anchor-id="bias-increases-as-predator-nears-target">Bias increases as predator nears target</h4>
<p>Rather than assuming a discrete state change, this option assumes the whale increasingly navigates towards the target as it gets closer. This could be the case if the strength of the external cue is a gradient. To do this, we treat <span class="math inline">\(\beta\)</span> as exponentially decreasing with distance to the target.</p>
<p><span class="math display">\[
\begin{align}
\beta &amp;= \beta_0e^{-\lambda d}
\end{align}
\]</span></p>
<p>Where <span class="math inline">\(\beta_0\)</span> is the value of <span class="math inline">\(\beta\)</span> at the target, <span class="math inline">\(\lambda\)</span> is the decay rate, and <span class="math inline">\(d\)</span> is the distance to the target. Therefore we are estimating 3 parameters.</p>
<ol type="1">
<li>The concentration of turning angles <span class="math inline">\(\kappa\)</span></li>
<li><span class="math inline">\(\beta_0\)</span></li>
<li><span class="math inline">\(\lambda\)</span></li>
</ol>
</section>
</section>
<section id="model-fitting-and-comparison" class="level3">
<h3 class="anchored" data-anchor-id="model-fitting-and-comparison">Model fitting and comparison</h3>
<p>Having demonstrated that two different processes may produce indistinguishable tail length distributions, we must also wonder whether the four generating processes described above are identifiable. We will test that hypothesis by simulating 1000 tracks from each of the generating processes. Then, we will fit each of the four models to each set of tracks and use model comparison (Bayes factors) to estimate the probability the set resulted from the actual generating process. If the models are identifiable, then we should see strong evidence supporting the actual generating process over the alternatives. Identifiability likely varies with parameters (<span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\beta\)</span>, their variations, and so on), so we must repeat the test for a variety of parameter values.</p>
<section id="generate-tracks" class="level4">
<h4 class="anchored" data-anchor-id="generate-tracks">Generate tracks</h4>
<p>Recall our model:</p>
<p><span class="math display">\[
\begin{align}
\theta_t &amp;= von~Mises(\mu_t, \kappa) \\
x_n &amp;= y_n = \theta_n = \gamma_n = 0 \\
\gamma_t &amp;= tan^{-1}\frac{y_n - y_{t+1}}{x_n - x_{t+1}} \\
\vec{\mu_t} &amp;= \hat{\theta}_{t+1}(1 - \beta) + \hat{\gamma}_t \beta \\
\mu_t &amp;= tan^{-1}\frac{\mu_{ty}}{\mu_{tx}} \\
x_t &amp;= x_{t + 1} - cos~\theta_t \\
y_t &amp;= y_{t + 1} - sin~\theta_t \\
\end{align}
\]</span></p>
<p>Each generating process parameterizes the model with slight modifications.</p>
<ul>
<li><p>Process 1 sets <span class="math inline">\(\beta\)</span> to 0 (CRW) but increases <span class="math inline">\(\kappa\)</span> after the detection event</p></li>
<li><p>Process 2 keeps <span class="math inline">\(\kappa\)</span> the same throughout the track, but increases <span class="math inline">\(\beta\)</span> after the detection event</p></li>
<li><p>Process 3 combines the increase in <span class="math inline">\(\kappa\)</span> and <span class="math inline">\(\beta\)</span></p></li>
<li><p>Process 4 doesn’t have a detection event, but <span class="math inline">\(\beta\)</span> exponentially decays the farther the track is from the target</p></li>
</ul>
<p>The following code generates 1000 tracks from each process.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unit vector convenience function</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>unit <span class="ot">&lt;-</span> \(alpha) <span class="fu">c</span>(<span class="fu">cos</span>(alpha), <span class="fu">sin</span>(alpha))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Process 1: CRW with increasing angle concentration</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>process1 <span class="ot">&lt;-</span> <span class="cf">function</span>(t_hat, kappa1, kappa2, n) {</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Process 1: only CRW, beta is 0</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initial conditions</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y <span class="ot">&lt;-</span> theta <span class="ot">&lt;-</span> gamma <span class="ot">&lt;-</span> mu <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> (n <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    gamma[t] <span class="ot">&lt;-</span> <span class="fu">atan2</span>(y[n] <span class="sc">-</span> y[t <span class="sc">+</span> <span class="dv">1</span>], x[n] <span class="sc">-</span> x[t <span class="sc">+</span> <span class="dv">1</span>])</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    mu_vec <span class="ot">&lt;-</span> <span class="fu">unit</span>(theta[t <span class="sc">+</span> <span class="dv">1</span>]) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> beta) <span class="sc">+</span> <span class="fu">unit</span>(gamma[t <span class="sc">+</span> <span class="dv">1</span>]) <span class="sc">*</span> beta</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    mu[t] <span class="ot">&lt;-</span> <span class="fu">atan2</span>(mu_vec[<span class="dv">2</span>], mu_vec[<span class="dv">1</span>])</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process 1 changepoint in kappa</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    theta[t] <span class="ot">&lt;-</span> CircStats<span class="sc">::</span><span class="fu">rvm</span>(<span class="dv">1</span>, mu[t], <span class="fu">ifelse</span>(t <span class="sc">&lt;</span> t_hat, kappa1, kappa2))</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    x[t] <span class="ot">&lt;-</span> x[t <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">-</span> <span class="fu">cos</span>(theta[t])</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    y[t] <span class="ot">&lt;-</span> y[t <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">-</span> <span class="fu">sin</span>(theta[t])</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">t =</span> <span class="dv">1</span><span class="sc">:</span>n, x, y, theta, gamma, <span class="at">dist =</span> (<span class="fu">sqrt</span>(x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> y<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Process 2: Switch from CRW to BRW</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>process2 <span class="ot">&lt;-</span> <span class="cf">function</span>(t_hat, kappa, beta, n) {</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initial conditions</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y <span class="ot">&lt;-</span> theta <span class="ot">&lt;-</span> gamma <span class="ot">&lt;-</span> mu <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> (n <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    gamma[t] <span class="ot">&lt;-</span> <span class="fu">atan2</span>(y[n] <span class="sc">-</span> y[t <span class="sc">+</span> <span class="dv">1</span>], x[n] <span class="sc">-</span> x[t <span class="sc">+</span> <span class="dv">1</span>])</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    beta_t <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(t <span class="sc">&lt;</span> t_hat, <span class="dv">0</span>, beta)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process 2 changepoint in beta</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    mu_vec <span class="ot">&lt;-</span> <span class="fu">unit</span>(theta[t <span class="sc">+</span> <span class="dv">1</span>]) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> beta_t) <span class="sc">+</span> <span class="fu">unit</span>(gamma[t <span class="sc">+</span> <span class="dv">1</span>]) <span class="sc">*</span> beta_t</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    mu[t] <span class="ot">&lt;-</span> <span class="fu">atan2</span>(mu_vec[<span class="dv">2</span>], mu_vec[<span class="dv">1</span>])</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    theta[t] <span class="ot">&lt;-</span> CircStats<span class="sc">::</span><span class="fu">rvm</span>(<span class="dv">1</span>, mu[t], kappa)</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    x[t] <span class="ot">&lt;-</span> x[t <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">-</span> <span class="fu">cos</span>(theta[t])</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    y[t] <span class="ot">&lt;-</span> y[t <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">-</span> <span class="fu">sin</span>(theta[t])</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">t =</span> <span class="dv">1</span><span class="sc">:</span>n, x, y, theta, gamma, <span class="at">dist =</span> (<span class="fu">sqrt</span>(x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> y<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Process 3: Switch from CRW to BRW and increase kappa</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>process3 <span class="ot">&lt;-</span> <span class="cf">function</span>(t_hat, kappa1, kappa2, beta, n) {</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initial conditions</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y <span class="ot">&lt;-</span> theta <span class="ot">&lt;-</span> gamma <span class="ot">&lt;-</span> mu <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> (n <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    gamma[t] <span class="ot">&lt;-</span> <span class="fu">atan2</span>(y[n] <span class="sc">-</span> y[t <span class="sc">+</span> <span class="dv">1</span>], x[n] <span class="sc">-</span> x[t <span class="sc">+</span> <span class="dv">1</span>])</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    beta_t <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(t <span class="sc">&lt;</span> t_hat, <span class="dv">0</span>, beta)</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process 3 changepoint in beta</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    mu_vec <span class="ot">&lt;-</span> <span class="fu">unit</span>(theta[t <span class="sc">+</span> <span class="dv">1</span>]) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> beta_t) <span class="sc">+</span> <span class="fu">unit</span>(gamma[t <span class="sc">+</span> <span class="dv">1</span>]) <span class="sc">*</span> beta_t</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    mu[t] <span class="ot">&lt;-</span> <span class="fu">atan2</span>(mu_vec[<span class="dv">2</span>], mu_vec[<span class="dv">1</span>])</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process 3 changepoint in kappa</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    theta[t] <span class="ot">&lt;-</span> CircStats<span class="sc">::</span><span class="fu">rvm</span>(<span class="dv">1</span>, mu[t], <span class="fu">ifelse</span>(t <span class="sc">&lt;</span> t_hat, kappa1, kappa2))</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    x[t] <span class="ot">&lt;-</span> x[t <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">-</span> <span class="fu">cos</span>(theta[t])</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    y[t] <span class="ot">&lt;-</span> y[t <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">-</span> <span class="fu">sin</span>(theta[t])</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">t =</span> <span class="dv">1</span><span class="sc">:</span>n, x, y, theta, gamma, <span class="at">dist =</span> (<span class="fu">sqrt</span>(x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> y<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Process 4: beta increases as predator nears target</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>process4 <span class="ot">&lt;-</span> <span class="cf">function</span>(t_hat, kappa, beta0, lambda, n) {</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initial conditions</span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y <span class="ot">&lt;-</span> theta <span class="ot">&lt;-</span> gamma <span class="ot">&lt;-</span> mu <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> (n <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>    gamma[t] <span class="ot">&lt;-</span> <span class="fu">atan2</span>(y[n] <span class="sc">-</span> y[t <span class="sc">+</span> <span class="dv">1</span>], x[n] <span class="sc">-</span> x[t <span class="sc">+</span> <span class="dv">1</span>])</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process 4 beta w.r.t. distance</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>    dist_t <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((y[n] <span class="sc">-</span> y[t <span class="sc">+</span> <span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (x[n] <span class="sc">-</span> x[t <span class="sc">+</span> <span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>    beta_t <span class="ot">&lt;-</span> beta0 <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>lambda <span class="sc">*</span> dist_t)</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>    mu_vec <span class="ot">&lt;-</span> <span class="fu">unit</span>(theta[t <span class="sc">+</span> <span class="dv">1</span>]) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> beta_t) <span class="sc">+</span> <span class="fu">unit</span>(gamma[t <span class="sc">+</span> <span class="dv">1</span>]) <span class="sc">*</span> beta_t</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>    mu[t] <span class="ot">&lt;-</span> <span class="fu">atan2</span>(mu_vec[<span class="dv">2</span>], mu_vec[<span class="dv">1</span>])</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>    theta[t] <span class="ot">&lt;-</span> CircStats<span class="sc">::</span><span class="fu">rvm</span>(<span class="dv">1</span>, mu[t], kappa)</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>    x[t] <span class="ot">&lt;-</span> x[t <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">-</span> <span class="fu">cos</span>(theta[t])</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>    y[t] <span class="ot">&lt;-</span> y[t <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">-</span> <span class="fu">sin</span>(theta[t])</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">t =</span> <span class="dv">1</span><span class="sc">:</span>n, x, y, theta, gamma, <span class="at">dist =</span> (<span class="fu">sqrt</span>(x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> y<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate four sets of tracks</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>n_iter <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>n_steps <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>process1_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">t_hat =</span> <span class="dv">50</span>, <span class="at">kappa1 =</span> <span class="dv">20</span>, <span class="at">kappa2 =</span> <span class="dv">40</span>, <span class="at">n =</span> n_steps)</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>process2_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">t_hat =</span> <span class="dv">50</span>, <span class="at">kappa =</span> <span class="dv">40</span>, <span class="at">beta =</span> <span class="fl">0.25</span>, <span class="at">n =</span> n_steps)</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>process3_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">t_hat =</span> <span class="dv">50</span>, <span class="at">kappa1 =</span> <span class="dv">20</span>, <span class="at">kappa2 =</span> <span class="dv">40</span>, <span class="at">beta =</span> <span class="fl">0.25</span>, </span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n =</span> n_steps)</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>process4_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">t_hat =</span> <span class="dv">50</span>, <span class="at">kappa =</span> <span class="dv">40</span>, <span class="at">beta0 =</span> <span class="fl">0.25</span>, <span class="at">lambda =</span> <span class="fl">0.05</span>, </span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n =</span> n_steps)</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>tracks <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>  <span class="at">process1 =</span> <span class="fu">lapply</span>(<span class="fu">seq</span>(n_iter), \(x) <span class="fu">do.call</span>(process1, process1_params)),</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>  <span class="at">process2 =</span> <span class="fu">lapply</span>(<span class="fu">seq</span>(n_iter), \(x) <span class="fu">do.call</span>(process2, process2_params)),</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">process3 =</span> <span class="fu">lapply</span>(<span class="fu">seq</span>(n_iter), \(x) <span class="fu">do.call</span>(process3, process3_params)),</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>  <span class="at">process4 =</span> <span class="fu">lapply</span>(<span class="fu">seq</span>(n_iter), \(x) <span class="fu">do.call</span>(process4, process4_params))</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compare-likelihoods" class="level4">
<h4 class="anchored" data-anchor-id="compare-likelihoods">Compare likelihoods</h4>
<p>What is the likelihood of the generated tracks being generated by each of the four processes? If they’re identifiable, we should see separation here. Note the likelihoods are presented on the log scale.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>process1_loglik <span class="ot">&lt;-</span> <span class="cf">function</span>(track, <span class="at">t_hat =</span> <span class="dv">50</span>, <span class="at">kappa1 =</span> <span class="dv">20</span>, <span class="at">kappa2 =</span> <span class="dv">40</span>) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">with</span>(track, { </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    theta1 <span class="ot">&lt;-</span> theta[<span class="sc">-</span><span class="fu">length</span>(theta)]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    theta <span class="ot">&lt;-</span> theta[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    gamma <span class="ot">&lt;-</span> gamma[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    t <span class="ot">&lt;-</span> t[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    mu_x <span class="ot">=</span> <span class="fu">cos</span>(theta1)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    mu_y <span class="ot">=</span> <span class="fu">sin</span>(theta1)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">=</span> <span class="fu">atan2</span>(mu_y, mu_x)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    kappa <span class="ot">=</span> <span class="fu">ifelse</span>(t <span class="sc">&lt;</span> t_hat, kappa1, kappa2)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(CircStats<span class="sc">::</span><span class="fu">dvm</span>(theta, mu, kappa))</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>process2_loglik <span class="ot">&lt;-</span> <span class="cf">function</span>(track, <span class="at">t_hat =</span> <span class="dv">50</span>, <span class="at">kappa =</span> <span class="dv">40</span>, <span class="at">beta =</span> <span class="fl">0.25</span>) {</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">with</span>(track, { </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    theta1 <span class="ot">&lt;-</span> theta[<span class="sc">-</span><span class="fu">length</span>(theta)]</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    theta <span class="ot">&lt;-</span> theta[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    gamma <span class="ot">&lt;-</span> gamma[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    t <span class="ot">&lt;-</span> t[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    beta_t <span class="ot">=</span> <span class="fu">ifelse</span>(t <span class="sc">&lt;</span> t_hat, <span class="dv">0</span>, beta)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    mu_x <span class="ot">=</span> <span class="fu">cos</span>(theta1) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> beta_t) <span class="sc">+</span> <span class="fu">cos</span>(gamma) <span class="sc">*</span> beta_t</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    mu_y <span class="ot">=</span> <span class="fu">sin</span>(theta1) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> beta_t) <span class="sc">+</span> <span class="fu">sin</span>(gamma) <span class="sc">*</span> beta_t</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">=</span> <span class="fu">atan2</span>(mu_y, mu_x)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(CircStats<span class="sc">::</span><span class="fu">dvm</span>(theta, mu, kappa))</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>process3_loglik <span class="ot">&lt;-</span> <span class="cf">function</span>(track, <span class="at">t_hat =</span> <span class="dv">50</span>, <span class="at">kappa1 =</span> <span class="dv">20</span>, <span class="at">kappa2 =</span> <span class="dv">40</span>, <span class="at">beta =</span> <span class="fl">0.25</span>) {</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">with</span>(track, { </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    theta1 <span class="ot">&lt;-</span> theta[<span class="sc">-</span><span class="fu">length</span>(theta)]</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    theta <span class="ot">&lt;-</span> theta[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    gamma <span class="ot">&lt;-</span> gamma[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    t <span class="ot">&lt;-</span> t[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    beta_t <span class="ot">=</span> <span class="fu">ifelse</span>(t <span class="sc">&lt;</span> t_hat, <span class="dv">0</span>, beta)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    mu_x <span class="ot">=</span> <span class="fu">cos</span>(theta1) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> beta_t) <span class="sc">+</span> <span class="fu">cos</span>(gamma) <span class="sc">*</span> beta_t</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    mu_y <span class="ot">=</span> <span class="fu">sin</span>(theta1) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> beta_t) <span class="sc">+</span> <span class="fu">sin</span>(gamma) <span class="sc">*</span> beta_t</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">=</span> <span class="fu">atan2</span>(mu_y, mu_x)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    kappa <span class="ot">=</span> <span class="fu">ifelse</span>(t <span class="sc">&lt;</span> t_hat, kappa1, kappa2)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(CircStats<span class="sc">::</span><span class="fu">dvm</span>(theta, mu, kappa))</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>process4_loglik <span class="ot">&lt;-</span> <span class="cf">function</span>(track, <span class="at">t_hat =</span> <span class="dv">50</span>, <span class="at">kappa =</span> <span class="dv">40</span>, <span class="at">beta0 =</span> <span class="fl">0.25</span>, <span class="at">lambda =</span> <span class="fl">0.05</span>) {</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">with</span>(track, { </span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    theta1 <span class="ot">&lt;-</span> theta[<span class="sc">-</span><span class="fu">length</span>(theta)]</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    theta <span class="ot">&lt;-</span> theta[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    gamma <span class="ot">&lt;-</span> gamma[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    t <span class="ot">&lt;-</span> t[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    beta_t <span class="ot">&lt;-</span> beta0 <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>lambda <span class="sc">*</span> dist[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    mu_x <span class="ot">=</span> <span class="fu">cos</span>(theta1) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> beta_t) <span class="sc">+</span> <span class="fu">cos</span>(gamma) <span class="sc">*</span> beta_t</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>    mu_y <span class="ot">=</span> <span class="fu">sin</span>(theta1) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> beta_t) <span class="sc">+</span> <span class="fu">sin</span>(gamma) <span class="sc">*</span> beta_t</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">=</span> <span class="fu">atan2</span>(mu_y, mu_x)</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(CircStats<span class="sc">::</span><span class="fu">dvm</span>(theta, mu, kappa))</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>likelihood_comparison <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">generating_process =</span> <span class="fu">paste0</span>(<span class="st">"process"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">track =</span> <span class="fu">seq</span>(n_iter),</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">likelihood_process =</span> <span class="fu">paste0</span>(<span class="st">"process"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">loglik =</span> <span class="fu">pmap_dbl</span>(</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>    ., </span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(generating_process, track, likelihood_process) {</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>      tr <span class="ot">&lt;-</span> tracks[[generating_process]][[track]]</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>      loglikfn <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="fu">paste0</span>(likelihood_process, <span class="st">"_loglik"</span>))</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">loglikfn</span>(tr)</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(likelihood_comparison, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> generating_process,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> loglik,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> likelihood_process)) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.5</span>, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.6</span>)) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-lik-comp" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lik-comp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="detect_range_files/figure-html/fig-lik-comp-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lik-comp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: The likelihood of a track coming from its actual generating process is not substantially different than the likelihood of a different generating process. For example, consider tracks generated by process 1 (left set of boxplots). The distribution of likelihoods those tracks came from process 1 (green) largely overlaps the distribution of likelihoods those tracks came from process 3 (purple).
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>